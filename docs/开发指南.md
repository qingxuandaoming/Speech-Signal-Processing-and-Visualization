# 开发指南

## 概览

- 项目名称：实时语音信号处理系统（`real_time_voice_processing`）
- 目标：实时采集、处理与可视化语音信号，支持语音活动检测（VAD）
- 主要模块：`runtime/engine.py`、`ui/visualization.py`、`signal_processing/`、`config.py`

## 环境与依赖

- 推荐 Python 3.10（本项目在 3.10 上测试通过）
- 使用虚拟环境进行依赖隔离（遵循“项目依赖管理”约定）

### 快速开始（Windows PowerShell）

```powershell
# 创建并激活虚拟环境
py -3.10 -m venv .venv
.\.venv\Scripts\Activate.ps1

# 安装依赖（推荐使用包内 requirements）
pip install -r real_time_voice_processing\requirements.txt

# 或使用脚本一键创建（如已安装 PowerShell 7）
pwsh ./scripts/setup_venv.ps1
```

### Linux/macOS

```bash
python3.10 -m venv .venv
source .venv/bin/activate
pip install -r real_time_voice_processing/requirements.txt
```

## 运行与测试

- 运行主程序：`python real_time_voice_processing/main.py` 或在仓库根目录执行 `python main.py`
- 运行演示脚本：`python real_time_voice_processing/demo.py`
- 运行单元测试：`pytest`

## 代码风格

- Python 文件命名使用 `snake_case`（示例：`signal_processing.py`）
- 使用 `black`（行宽 100）与 `flake8` 进行基本格式检查（配置见 `pyproject.toml`）

## 配置管理

- 全部运行参数集中在 `config.py` 的 `Config` 类中，包含音频、缓冲区、阈值、可视化与线程参数
- 常见修改：采样率（`SAMPLE_RATE`）、帧长（`FRAME_SIZE`）、能量与过零率阈值（`ENERGY_THRESHOLD`、`ZCR_THRESHOLD`）

## 目录结构（简化）

```
real_time_voice_processing/
├── main.py                  # 入口文件（启动运行时与 UI）
├── signal_processing/       # 信号处理算法子包（拆分为多个模块）
│   ├── __init__.py          # 聚合类与兼容包装
│   ├── windows.py           # 窗函数
│   ├── preprocessing.py     # 预加重与分帧
│   ├── time_features.py     # 时域特征
│   ├── frequency_features.py# 频域特征
│   └── vad.py               # 语音活动检测
├── config.py                # 参数配置
├── runtime/
│   └── engine.py            # 采集与处理线程（运行时引擎）
├── ui/
│   └── visualization.py     # 可视化界面
├── demo.py                  # 功能演示脚本
└── requirements.txt         # 依赖清单

tests/
└── test_signal_processing.py # 算法单元测试
```

## 开发流程建议

- 新增算法时：在 `SignalProcessing` 中添加静态方法，并补充 `tests/` 测试
- UI 交互改动时：确保 `VisualizationUI` 与 `AudioRuntime` 的接口一致（例如 `get_recent_processed`）
- 性能优化：优先向量化实现，适当调节 `AUDIO_BUFFER_SIZE` 与 `THREAD_SLEEP_TIME`

## 文档约定

- 项目文档统一使用 Markdown
- 涉及公式的部分使用 LaTeX 语法，例如 `$E=mc^2$`

## 文档构建（Sphinx）

- 文档源位于 `docs/`，已接入 Sphinx 与 MyST（支持 Markdown）
- 生成 HTML 文档：

```bash
# 在仓库根目录执行（确保已安装依赖）
python -m pip install -r real_time_voice_processing/requirements.txt
sphinx-build -b html docs docs/_build/html
```

- 打开 `docs/_build/html/index.html` 即可浏览完整文档与 API
- 自动 API 文档通过 `autodoc` 从包源代码提取注释与签名

## 参考

- 详细架构与算法请参考《架构说明》和《算法说明》文档
